---
layout: default
title: Analisi statica di documenti e software malevoli
description: Prof.ssa Federica Paci
---

# Analisi statica di documenti pdf malevoli

L'analisi statica di un documento PDF malevolo è il processo di esaminare il file senza eseguirlo, al fine di identificare possibili minacce e tecniche di attacco utilizzate. Questo tipo di analisi è essenziale per comprendere il comportamento di un file sospetto e per mitigare i rischi associati. Ecco i passaggi dettagliati su come effettuare l'analisi statica di un documento PDF malevolo.

## Struttura del PDF

Un documento PDF inizia con un'intestazione che specifica la versione del formato PDF. Il corpo del PDF contiene tutti gli oggetti definiti nel documento. Gli oggetti possono includere testi, immagini, annotazioni, riferimenti ai font, e codice Javascript. In particolare gli oggetti di tipo stream possono contenere dati. Ogni oggetto è identificato da un numero di oggetto e un numero di generazione, come nell'esempio è che segue:
```
5 0 obj
<< /Length 72 >>
stream
BT
/F1 12 Tf
100 700 Td
(Hello, World!) Tj
ET
endstream
endobj
```

## Analisi statica con yara 

YARA è un linguaggio e strumento di matching pattern progettato per identificare e categorizzare i campioni di malware. Si basa su regole scritte in un linguaggio specifico che consente di descrivere pattern di byte, stringhe di testo e altre caratteristiche che possono essere utilizzate per rilevare malware. 

Per eseguire la classificazione di un documento pdf con yara aprite un terminale e digitate il seguente comando:

```
# yara -w -m -s <PATH ALLA DIRECTORY CON LE REGOLE> badpdf.pdf

```
## Analisi delle stringhe
L'analisi delle stringhe contenute nel documente aiuta a identificare URL o indirizzi IP da cui il documento scarica il malware, nomi di file creati, e codice Javascript contenuto nel documento.
Per analizzare le stringhe contenute nel documento pdf e' possibile utilizzare i seguenti comandi:

```
# strings –a badpdf.pdf | more
# xorsearch badpdf.pdf http
# xorsearch –p badpdf.pdf
```
## Identificazione di Metadati 

Per estrarri i metadati contenuti nel documento pdf si puo' utilizzare **exiftool**. I metadati del documento possono essere utili per capire quando e da chi e' stato creato il documento pdf malevolo.
```
# exiftool badpdf.pdf
```

## Identificazione di oggetti 

Utilizza **pdfid** per identificare gli oggetti presenti nel PDF. Questo strumento aiuta a rilevare elementi sospetti come JavaScript, oggetti embed, e altro.

```
# pdfid.py badpdf.pdf
```

In particolare, analizza l'output per elementi sospetti come /JavaScript, /OpenAction, /AA, /EmbededFile, /Launch, /Name, /URI ecc.

## Parsing e Analisi degli Oggetti PDF

Utilizza **pdf-parser** per esaminare più in dettaglio i contenuti del PDF, specialmente gli oggetti sospetti identificati con pdfid.
```
pdf-parser.py badpdf.pdf
```

Esamina gli oggetti uno per uno, prestando particolare attenzione agli oggetti che contengono JavaScript, collegamenti a URL esterni, o stream binari.

Per identificare un oggetto che contiene particolari parole chiavi e' possibile utilizzare i seguenti comandi:
```
# pdf-parser.py --search openaction badpdf.pdf
# pdf-parser.py --search javascript badpdf.pdf
```
## Decodifica e Analisi dei Flussi

Utilizza **pdf-parser** per estrarre e decodificare i flussi di dati che possono contenere codice obfuscato o shellcode.
```
pdf-parser.py -o <object_number> badpdf.pdf
```
Per decodificare un oggetto e' possibile utilizzare il seguente comando:
```
pdf-parser.py -o <object_number> -f badpdf.pdf
```
## Analisi dei JavaScript Incorporati

Se il PDF contiene JavaScript, estrailo e analizzalo separatamente. Usa **pdf-parser** per identificare e estrarre gli oggetti JavaScript.
```
pdf-parser --object <object_number> -f -w -d objNUM.js badpdf.pdf
```
Analizza il JavaScript per identificare comportamenti dannosi, come il download di payload aggiuntivi o l'esecuzione di codice arbitrario.

Un altro tool molto utile per analizzare i documenti pdf e' **peepdf**. Strumenti come peepdf offrono un'interfaccia più avanzata per l'analisi dei PDF malevoli, permettendo di esplorare il documento in modo interattivo.
```
peepdf.py -i badpdf.pdf
```
## Documentazione e Report

Documenta tutti i passaggi eseguiti e i risultati ottenuti durante l'analisi. Include informazioni dettagliate sugli oggetti sospetti, il codice trovato e il comportamento previsto.

# Analisi statica di documenti Office malevoli

# Analisi statica di malware per Windows

# Creazione di un malware per Windows
